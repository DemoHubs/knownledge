#锁和监视器

监视器是用来**实现线程同步而采取的技术手段**。

在java中，每个对象（包括Class单例对象）都会拥有一个锁，每个对象都会和一个监视器关联。锁是存在于对象内部的数据结构，监视器是一个独立的结构，但是和对象关联。

**监视器是操控线程的**，它会维持一个代码数据区和线程队列，保证同一时刻只有1个线程访问代码数据区。监视器就是通过对象里面的锁来完成同步的。具体操作流程是：

- 当代码进入同步块时，找到对象关联的监视器，然后调用监视器获取锁的方法
- 监视器会获取**对象头里面关于锁的信息**作为参数，尝试去获取锁
- 获取到锁，则进入同步代码块，否则等待
- 当代码退出同步区域时，获取监视器，执行释放锁的操作



## 问题



**如何排查死锁？**

- jps查看java进程id
- jstack pid查看进程执行情况
- 看到死锁日志，定位到代码，解决问题
  - ![image-20200412124639361](https://tva1.sinaimg.cn/large/007S8ZIlgy1gdqvxsbllqj31q20sqtgp.jpg)





## 参考

https://blog.csdn.net/tales522/article/details/80853489

[检测死锁的方式汇总](https://www.cnblogs.com/aflyun/p/9194104.html)

