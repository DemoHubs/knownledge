# 面经





## 2020年 03月29号 阿里

### 一面

- 1、支付系统业务上的思考
- 2、根据什么指标，怎么设计的系统
  - 支付系统的指标其实就是自己给的一个估算，然后整个系统支持横向扩展，如果系统撑不住了，那么可以通过增加业务机器的数量来保证系统可用
- 3、怎么处理红包缓存和数据库一致性的问题
- 4、怎么处理缓存故障
- 5、聊聊垃圾回收
- 6、红包接入层、红包业务层怎么支持高并发
- 7、支付系统的业绩，我说了扫码收款，单月1400万(支付系统基本上整个都是我设计和开发的)
- 8、RocketMQ为什么能起到削峰填谷的作用?



### 二面（笔试）

- 1、两个线程交替打印1-100的整数
  - 题目说明：两个线程交替打印1-100的整数，一个打印奇数，一个打印偶数，要求输出结果有序
- 2、登陆安全的题目，如果你的系统登陆接口在被刷。我们要建立一个防刷系统。根据登陆ip，30分钟之内，只能请求30次登陆请求，如果超过这个限制，则整个ip限制登陆请求30分钟



### 三面（主管）

- 1、redis的数据结构，及业务的使用场景、底层原理
  - 业务场景：缓存红包数据、分布式锁
- 2、7个元素  怎么计算出多少个子集
  - 暴力法，一个个枚举
  - 公式法，n个元素的子集个数是2^n，利用公式直接算出来
- 3、id怎么生成的？
  - 雪花算法  
- 4、高并发情况下，怎么避免id服务被压垮
  - 多个id服务组成集群
- 5、类加载机制的过程
- 6、CPU打满了排查过程
- 7、怎么生成快照
  - 使用jmap指令 -dump参数可以生成快照
- 8、平时怎么学习，看什么书
  - 整体上来说，每天晚上学习1到2个小时，可以是看书籍、博客、视频。主要是看书
- 9、比较难的项目
  - 支付系统，先介绍架构、每个模块点、难点、高并发
- 10、如果id是自增的，怎么进行分表
  - 插入数据之前，使用id生成器生成一个全局唯一自增的id
  - 要说清楚我们使用的算法就是雪花算法，生成的id就是自增的
- 11、加载多个类的情况下，类加载是串行还是并行？ 
- 12、你觉得自己的算法、计算机系统、网络学习得怎样？  这里很致命。。
  - 可以这样子回答：有学习相关书籍和积累
- 13、redis缓存淘汰策略
  - 先说Redis有哪几种缓存淘汰策略
    - 尝试淘汰设置了过期时间的key，淘汰最近最少使用；过期集合中淘汰随机淘汰；过期集合中淘汰寿命最短的
    - 全部key集合中淘汰最近最少使用的、随机淘汰
    - 停止服务写请求，默认
  - 然后再说Redis的LRU是怎样实现的
- 14、你们系统的订单号是怎样的格式
  - 时间戳、机器IP、用户id、业务类型、自增编号（1~9999）
- 15、如果jmap -dump快照的时候，程序没有响应了，怎么处理？
  - 可以使用-F参数，可以强制生成快照





### 四面（BOSS）

1. QPS 800/s 变成 8万，系统怎么改？
   1. 从读高并发、写高并发进行分析
   2. 针对读高并发，热点数据存放到redis缓存，是可以扛得住的
   3. 针对写高并发，依然是采用异步的方式，接入层更新缓存，然后通过消息队列传递消息给业务层，业务层更新数据库。
      1. 更新数据库的请求堆积在消息队列内，不会对数据库造成很大的冲击。但是会造成处理消息延迟
      2. 这时候就要适当增加消费者的数量
      3. 对数据库进行分库分表，从而提高数据库的高并发写能力。如果是在红包系统，则对红包表按照红包id进行水平分表。把更新请求均摊到不同的节点，从而提高并发处理能力。
2. mysql优化的经历
   1. 优化关联查询
   2. 优化分页查询
3. 系统安全怎么保证？
   1. 抓包重放可能导致的问题：比如说充钱，由于我们的订单号是递增的，假如黑客他抓到一个请求，然后暴力递增订单号，然后刚好给他碰中了一个订单号，他拿着这个订单号去进行资金操作，从而使系统资金错乱。
4. 怎么从头开始设计支付系统
   1. 讲述演进的过程
5. 每一台机器的配置
   1. 部署在k8s上，设置最大CPU是1，最大内存是2G。
   2. 为什么设定这个数字？ 
      1. 大概定的数字，如果设置太小了，超过阈值容易导致重启。设置大了，浪费资源。
6. 讲了一下支付系统架构
7. 学校是几本
   1. 二本、民办





### 五面（笔试）

- 粗心的小明在记IPv4地址时忘了加点，导致记不清原来的具体地址是哪个了，你能帮他分析出所有可能的结果吗？
- 请合并所有重叠的区间值，输出最简表示方式。
- 实现两个线程，一个线程打印1到52的整数，另一个线程打印A到Z共26个字母，打印效果是12A34B...5152Z。
- 杭州西站某开设了3个售票窗口同时售卖新开通的A1688次列车车票共计200张，使用3个线程模拟售票扣库存inventory的操作，确保不超卖。
- 解答参考 “方案设计题”
- 总结：继续刷LeetCode，并且这次也发现在并发编程上一些不足。







## 2020年 03月20号 阿里

### 一面

1. 怎么判断一个链表上面是否有环
   1. 解法一：每个节点增加一个标志位字段，如果遍历过这个节点，则标志位设置为true。如果一个节点的next节点为true，则表示有环。
   2. 解法二：设置两个指针，开始都指向链表头，然后其中一个指针每次向前走一步，另一个指针每次向前走两步，如果快的遇到NULL了，证明该链表中没有环，如果有环，快的指针每次都要比慢的多走一步，最终两个指针会相遇。时间复杂度为O(n)。
2. 怎么快速求出链表的长度
   1. 使用一个字段记录元素个数，需要获取链表长度的时候，直接返回这个元素的个数。
   2. 在插入的时候字段值加1，在删除元素的时候字段值减1
3. HashMap
   1. 原理
   2. 平时工作上面的使用场景
      1. 读取一个json字符串，然后转换成Map，然后获取其中的值
      2. 数据库字段存储json格式的字符串，就先把字段值传递到map中，然后把map转换为json字符串
   3. 为什么使用红黑树，而不是使用其他的数据结构
4. ArrayList、LinkedList
   1. 原理
   2. 使用场景
      1. 对于查询比较多的场景，就使用ArrayList
      2. 对于新增、删除比较多的场景，就使用LinkedList
5. 一张表上面有200w条数据，怎么做分页查询
   1. 我的回答是通过“延迟关联”，是满足条件的，如果数据更大，就考虑用分表
   2. 辅助索引、覆盖索引的区别







## 2020年 02月11号 阿里

### 一面

- 1、一致性hash算法
- 2、支付系统架构
- 3、灰度系统架构



### 二面（主管）

**可能是最难的一次面试了**

- 1、哈夫曼编码原理，用来做什么的
  - 参考：”算法——》数据结构——》哈夫曼树“
- 2、对于数据库的热点数据行，可能有很多请求同时到达数据库了，然后对这个数据进行更新，业内通用的设计方案是什么？
  - 业务场景：有一款秒杀系统，某个商品的库存是10，很多用户同时进行秒杀，会去更新”库存”这个数字，不能使用分布式锁，怎么保证更新正确？
  - 参考：“项目——》热点数据更新问题”
- 3、假如让你设计一款秒杀系统，怎么设计
  - 参考：“项目——》系统设计与经验——》秒杀系统”
- 4、protocol buffer动态码流的具体是怎么做到的？（问这个算法是怎么实现的）
  - 参考：”框架——》序列化——》protocol buffer“
- 5、redis和Zookeeper作为分布式锁的区别，什么情况下使用redis，什么情况下使用Zookeeper会比较好
- 6、**具体说说不加分布式锁可能有并发问题的情况？怎么解决这些情况？**（重点解决啊，当时卡了很久。。）
  - 处理一个业务请求有3步，读取数据、修改数据、更新数据，举出具体的业务场景
  - 比如说公有账户的充值，咱们支付系统有一个公有账户（企业红包），如果有2个用户对这个公有账户进行充值，并且系统没有进行并发控制，则可能出现如下情况：
    - 公有账户本来有金额100元
    - 用户A读取公有账户的余额是100元，进行充值，在100的基础上面加50
    - 用户B读取公有账户的余额是50元，进行充值，在100的基础上面加30
    - 由于用户B晚于用户A，最终公有账户的余额变成130。正常应该是180
  - 也就是说，存在丢失更新的问题
  - 针对这种情况，需要使用分布式锁进行并发控制，先获取分布式锁再进行资金处理，处理完之后释放分布式锁，让请求串行化执行。
- 7、直接内存dirctBuffer有什么特性，可以用来做什么？
  - 参考：”java——》jvm——》jvm“
- 8、线程池有哪些配置参数，设置线程池的线程数量的时候，通用规则是什么？（根据IO密集型、CPU密集型）
  - 参考：“java——》并发——》线程池”
- 9、Zookeeper为什么有原子性，Zookeeper实现分布式锁的原理
- 10、springmvc中bean的生命周期
- 11、MVCC的原理； 快照读、当前读有什么不同？
  - 参考：“MySQL——》锁”
- 12、redis支持持久化吗？有哪些持久化方式，这些持久化方式有什么不用？ AOF的方式支持绝对安全吗？











## 2019年 12月26号 阿里

### 一面

- 1、 支付平台回调的高可用保证
  - 见“项目——》支付——》支付系统”
- 2、红包生成金额的算法
  - 见“项目——》支付——》支付系统——》红包”
- 3、10个redis节点组成的集群，分摊所有key，这时候客户访问的key在所有的节点挂了，怎么保证高可用
  - 每个节点再组成主从集群
- 4、资金真的出问题了，怎么补偿
  - 内部资金错误，采用调账
  - 外部资金错乱，比如说提现金额错误，这就主要是预防，人工审核大金额的提现
- 5、如何处理幂等
- 6、支付系统是分布式的，怎么保证数据的一致性？
  - 重试、补偿、回滚、日志备份、监控、调账
- 7、灰度系统 mq灰度的实现，怎么保证灰度机器发送的mq消息被灰度机器消费
  - 灰度环境采用灰度的topic，正式环境采用正式的topic
- 8、redis集群（codis）
- 9、java控制并发，如synchronized、ReentrankLock，他们的原理



### 二面（主管）

- 1、top的load指标
- 2、研发生命周期
  - 实际上就是软件开发生命周期，参考：https://www.jianshu.com/p/f3d2759edb3d
  - 软件立项——》可行性分析——》需求分析——》概要设计——》详细设计——》编码——》单元测试——》集成测试——》系统测试——》验收测试——》维护
  - 单元测试、集成测试、系统测试的区别
    - 单元测试是粒度最小的测试，针对函数
    - 集成测试则是测试模块与模块之间调用是否正常
    - 系统测试是在系统层面测试系统功能是否正常运行
    - 参考：https://blog.csdn.net/slforeverlove/article/details/47027943
- 3、浏览器输入地址，会经过哪些步骤
- 4、项目亮点
- 5、业余学习哪些书籍(这个说的太少了)
- 6、NIO、BIO的区别，NIO相对于BIO的优点
- 7、查找某个端口被什么应用占用着
- 8、慢sql怎么优化



### 三面（BOSS面）

- 1、怎么学习一门新技术，学过哪些比较新的技术
  - 用熟悉——》学习原理——》记录笔记
  - 比如说RedLock，这个技术主要解决分布式环境下，redis缓存主节点故障导致重复加锁的问题。它的原理概括来说就是通过Redis节点组成集群，只有过半节点加锁成功，才算真正加锁成功。
- 2、k8s原理
- 3、怎么做code review
  - 时间上，主要是上线前几天做一次code review
  - 主要从2个方面来检查：
  - 1、代码规范：是否遵循单一职责原则、重复代码、单个函数太多余冗长、todo是否都清理掉了
    - 找最近开发的一段业务代码进行code review
    - 通过checkStyle检查代码规范
  - 2、检查bug：使用findBug查看系统代码中bug，并且及时解决。
- 4、单元测试技术，用过哪些(jmockit)
- 5、灰度系统
  - 从使用场景——》架构——》实现原理——》与竞品的区别
  - 下次要主动说明从web层开始路由
- 6、支付系统
  - 使用场景——》架构——》实现原理——》与竞品区别
- 7、为什么会考上这个学校
  - 高考那段时间失眠严重，并且心态很紧张，导致考试没有发挥好，所以就考试了这个学校
- 8、单元测试怎么保证每一个路径都覆盖到呢？
  - 1、每个项目有对应的测试项目
  - 2、每个类都有对应的测试类
  - 3、每个方法都有对应的几个测试方法，每一个测试方法用于测试一个代码路径
- 9、不同的部门，有针对的准备吧



### 四面（hr）

- TCP和UDP的区别，tcp、udp的端口分别是什么
  - TCP和UDP的端口是程序里面绑定的，不是写死的。hr随便问，自己也没有被问过这种问题，一下子懵了，要注意辨别。
- 愿不愿意加班
- 吉林大学珠海学院是民办还是公办
  - 民办
- 做过最有难度的系统是什么，为什么交给你做
  - 支付系统；主管想要锻炼我的设计能力和开发能力
- 支付系统的用户量是多少
  - 支付系统的用户量为300w。这里就牵扯到**根据哪些指标去设计一个系统的问题**
  - **当时特别的奇怪，hr听成了8个，我居然没有去纠正。我自己一时也忘记了具体是多少个，所有懵了。其实这种问题非常关键，关系到系统的价值。一定一定要想清楚再说。**
- 先说结论吧：**这次失败的主要原因，是因为对hr的问题没有经过思考，就说出来。并且hr有误解的地方，没有从源头开始纠正。 另外，视频面试的时候，看着别人讲话，要咬文嚼字，理清楚别人的意思啊**
- **另外还有hr口中失败的原因，等待他的回复**
  - 原因：表达不够简练，项目技术细节不清楚
  - 复盘：hr问什么，就回答什么，不要去扩展。
- 有考虑过别的公司吗？
  - 没有









## 2019年 12月15号 阿里

### 一面

- 1、为什么hashmap不用AVL树，用红黑树
  - 见“jdk源码——》集合——》hashMap”
- 2、怎么找到链表的倒数第n个节点。如果有环，怎么办？
  - 见“算法——》LeetCode——》基础算法题”
- 3、int a=300;  integer b=300，使用等号是true还是false;     integer a=300，b=300呢？     integer a=3, b=3呢？
  - true 、 false、  true
- 4、hashMap1.8相对于1.7做了哪些改进
  - 见“jdk源码——》集合——》hashMap”
- 5、排查线上问题，比如说cpu打满了，怎么排查？
  - 见“项目——》线上问题排查”
- 6、老年代都是什么对象
  - 见“java——》jvm——》GC垃圾回收”
- 7、new一个hashMap，初始容量为1000，然后插入1000个元素，会不会触发扩容。如果是10000呢？
  - 见“jdk源码——》集合——》hashMap”
- 8、其他，比如红包项目、Dubbo、Redis答得还行















## 2019年11月 阿里



### 一面

- 1、java基础类型：byte、char、boolean、short、int、long、float、double
- 2、java是值传递还是引用传递
- 3、一个char多少字节
- 4、ip的网络拓扑
  - 有很多网络，通过路由器连接起来。当源主机发送HTTP报文给目标主机，源主机的路由器获得HTTP报文中的目标主机的IP地址，然后判断该IP地址所处的网络是否和路由器直接相连，如果是，则直接交付给文。否则，把HTTP报文转交给下一个路由器。
- 5、tcp怎么把数据传递给ip
  - 加上IP首部，比如说源主机IP地址、目标主机IP地址
- 6、场景题：双11接近12点的时候，jvm的内存逐渐升高，只有发生full gc，内存才降下来，什么原因
  - 我的思路是：接近12点的时候，请求越来越多，每次请求都可能创建一些对象，并且请求还没有结束，这些对象被引用着，随着占用内存升高，开始频繁发生minor gc，由于请求量很大，很多请求也还没结束，这些临时对象还被引用着，因此无法回收。
    当minor gc达到一定次数，这些临时对象还晋升到老年代了。当老年待内存不够，发生分配担保失败，引发了full gc，由于这时之前的很多请求结束了，因此很多临时对象没有被引用了，从而被回收了，内存又被释放出来。
- 7、findClass和loadClass的区别
  - findClass在ClassLoader中是父类找不到，然后去子类中查找，如果只重写findClass方法，实际上还是会走双亲委派模型
  - loadClass在ClassLoader中是先去父类中找类，找不到再调用findClass去找。因此如果想破坏双亲委派模型，重写loadClass方法才行。（当然，还可以利用线程上下文类加载器等方法）
- 8、桶令牌算法的实现限流
- 9、如果抢红包的时候，缓存中的红包数据没有了，怎么办？
- 10、哪些对象可以称为GC Root
- 11、类对象的回收条件
- 12、Integer的缓存范围
- 13、自己实现客户端来使用Cookie
- 14、支付平台回调过程中有哪些参数？





### 二面

- 1、CMS收集器
  - （1）执行流程：初始标记、并发标记、重新标记、并发清除
- 2、一个集群有好几个redis节点，同时收到hsetnx请求，那么会不会发生这样的情况：几个redis节点同时判断key没有，然后就插入。(答案在项目解析里)
- 3、红包里面，1个人同时点了很多下抢红包，产生2个请求，一个请求来到服务A，一个请求来到服务B，那么怎么保证这个人不会抢到2个红包？（如何保证一个人不会抢到多个红包） (答案在项目解析里)
- 4、多个人同时抢，如何保证不会抢到同一个红包？(答案在项目解析里)
- 5、dubbo消费调用过程
- 6、设计原则（只说了一点，要加强）、设计模式（整理一下咱们项目中使用到的所有设计模式）
- 7、MySQL的索引实现
  - （1）有哪些索引，这里说的不够全： 聚集索引、联合索引、唯一索引、覆盖索引
- 8、RocketMQ是顺序消费的吗？如何实现顺序消费？顺序消费有什么坏处？
- 9、假设要重启一个dubbo服务，怎么切掉流量重启，然后重启完了再切回流量
  - 参考   Dubbo优雅停机——》问题





### 三面（主管）

- 1、如果hsetnx实际上是成功的，但是redis返回超时，这种情况怎么处理

- 2、算法：（1）堆排序的实现、时间复杂度    （2）快速排序的实现、时间复杂度

​                     （3）走阶梯问题，如果一次可以走1步或者2步，一共有多少种走法？

​				参考：https://blog.csdn.net/sinat_25972161/article/details/72456518

- 3、如何实现一个自定义同步器
- 4、如何保证高并发
- 5、峰值QPS、一天的流量PV
- 6、什么是高并发、高流量？
  - 高并发指的是流量很大的情况下，系统还能正常运行，并且保证数据不出错
  - 高流量指的是请求量很大





### 四面（BOSS面）

- 1、Dubbo整体架构，分为几层

- 2、Dubbo默认使用什么解析协议，还知道哪些协议

- 3、Zookeeper是什么协议实现的，为什么不直接使用Paxos协议

- 4、Synchronize为什么使用自旋锁

- 5、自旋锁适用于什么场景

- 6、Java有哪几种锁

  synchronize、ReentrantLock、ReadWriteLock、CAS实现乐观锁

- 7、Java值传递、引用传递

- 8、形参、实参是什么，有什么区别

  - 见“java基础——》问题”

- 9、灰度系统的实现

- 10、支付系统的实现，怎么抗住高并发

- 11、Dubbo网络调用过程（其实就是远程调用过程）









## 扩展

1、**分布式相关的，比如Spring、Dubbo、ZK、Redis、DB、MQ这些重点准备**

2、做过的项目挑出来讲的，要了解整个项目的价值、和发展方向



### 刷题

无论想进哪个公司，项目经验、基础、刷题 这3样东西都是必不可少的。

以我目前的状态，其实项目经验、基础是有的了。刷题还是比较欠缺。

刷题分为算法和基础模块吧，



\- 算法：

（1）总结并且刷《数据结构与算法之美》上面的题目（get）

（2）leetCode 100道题（目前进度 43 道）

题目从这里选 https://leetcode-cn.com/problemset/top/



\- 基础模板：

每个100道题吧。

（1）计算机基础，目前进度 40 道

（2）SQL语句，目前进度 24 道

（3）网络，目前进度 55 道



\- 概率：

（1）如果还有余力，就把概率题也刷一下，50道



### 英语

由于12月份还是有可能面试lazada的，所以英语还是要保持学习。

\- 每天50个单词

\- 每天练习一下口语







## 面经收集

[菜鸟网络面经](https://zhuanlan.zhihu.com/p/89625950)（get）

[阿里面经](https://www.nowcoder.com/discuss/356120)

[菜鸟Java研发工程师（社招）面经](https://www.nowcoder.com/discuss/309103)

[阿里社招面经](https://www.nowcoder.com/discuss/322391?type=0&order=0&pos=14&page=1)

[阿里巴巴Java社招面经](https://www.nowcoder.com/discuss/350250?type=2&order=0&pos=54&page=1)

